<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WWII Veterans Memorial Trail Map - Norton, MA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <link rel="stylesheet" href="../dist/leaflet.awesome-markers.css">



  <style>
    body { margin: 0; padding: 0; }
    #map { height: 100vh; width: 100vw; }

    .awesome-marker {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .awesome-marker .am-glyph {
      display: block;
      width: 20px; /* Keep width and height equal to icon img tag values */
      height: 20px;
      position: relative;
      top: -2px;
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="../dist/leaflet.awesome-markers.js"></script>

  <script>
    const map = L.map('map').setView([41.99, -71.1869], 13);
    cyclOSM = L.tileLayer('https://{s}.tile-cyclosm.openstreetmap.fr/cyclosm/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '<a href="https://github.com/cyclosm/cyclosm-cartocss-style/releases" title="CyclOSM - Open Bicycle render">CyclOSM</a> | Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    })

    osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // Add click event listener
    map.on('click', function(e) {
      var lat = e.latlng.lat;
      var lng = e.latlng.lng;
      console.log("[" + lat + "," + lng + "]");
    });

    const trailGeojsonData = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [
            -71.14683,
            41.95189
          ],
          [
            -71.1478,
            41.95294
          ],
          [
            -71.14911,
            41.95436
          ],
          [
            -71.15036,
            41.9557
          ],
          [
            -71.15125,
            41.95667
          ],
          [
            -71.15298,
            41.95852
          ],
          [
            -71.15439,
            41.96007
          ],
          [
            -71.15646,
            41.96233
          ],
          [
            -71.15654,
            41.96249
          ],
          [
            -71.15668,
            41.96266
          ],
          [
            -71.15677,
            41.96277
          ],
          [
            -71.15698,
            41.96289
          ],
          [
            -71.15725,
            41.96317
          ],
          [
            -71.15872,
            41.96475
          ],
          [
            -71.15979,
            41.96596
          ],
          [
            -71.16137,
            41.96761
          ],
          [
            -71.16243,
            41.96881
          ],
          [
            -71.16284,
            41.96921
          ],
          [
            -71.16383,
            41.97029
          ],
          [
            -71.16489,
            41.97144
          ],
          [
            -71.16512,
            41.97169
          ],
          [
            -71.1653,
            41.97188
          ],
          [
            -71.16539,
            41.97198
          ],
          [
            -71.16556,
            41.97216
          ],
          [
            -71.16711,
            41.97383
          ],
          [
            -71.16788,
            41.97466
          ],
          [
            -71.16862,
            41.97551
          ],
          [
            -71.16883,
            41.97573
          ],
          [
            -71.16922,
            41.97612
          ],
          [
            -71.17013,
            41.9771
          ],
          [
            -71.17108,
            41.97815
          ],
          [
            -71.17177,
            41.97889
          ],
          [
            -71.17231,
            41.97947
          ],
          [
            -71.17237,
            41.97957
          ],
          [
            -71.17256,
            41.97966
          ],
          [
            -71.17262,
            41.97988
          ],
          [
            -71.17281,
            41.98002
          ],
          [
            -71.17299,
            41.98021
          ],
          [
            -71.17343,
            41.98069
          ],
          [
            -71.17424,
            41.98159
          ],
          [
            -71.17509,
            41.98257
          ],
          [
            -71.17533,
            41.98275
          ],
          [
            -71.17564,
            41.98306
          ],
          [
            -71.17614,
            41.98362
          ],
          [
            -71.17666,
            41.9842
          ],
          [
            -71.17743,
            41.98507
          ],
          [
            -71.17784,
            41.98551
          ],
          [
            -71.17805,
            41.98572
          ],
          [
            -71.17815,
            41.98582
          ],
          [
            -71.17825,
            41.98593
          ],
          [
            -71.17844,
            41.98612
          ],
          [
            -71.17892,
            41.98665
          ],
          [
            -71.17939,
            41.98716
          ],
          [
            -71.18047,
            41.98832
          ],
          [
            -71.18196,
            41.98992
          ],
          [
            -71.18334,
            41.99142
          ],
          [
            -71.18411,
            41.99227
          ],
          [
            -71.18417,
            41.9924
          ],
          [
            -71.18408,
            41.99247
          ],
          [
            -71.18301,
            41.99281
          ],
          [
            -71.18292,
            41.99291
          ],
          [
            -71.18289,
            41.993
          ],
          [
            -71.18304,
            41.99322
          ],
          [
            -71.1834,
            41.99367
          ],
          [
            -71.18382,
            41.99418
          ],
          [
            -71.18464,
            41.99514
          ],
          [
            -71.18507,
            41.99565
          ],
          [
            -71.18524,
            41.99587
          ],
          [
            -71.1853,
            41.99599
          ],
          [
            -71.18535,
            41.99614
          ],
          [
            -71.18548,
            41.99629
          ],
          [
            -71.18553,
            41.9965
          ],
          [
            -71.18575,
            41.99653
          ],
          [
            -71.18624,
            41.9965
          ],
          [
            -71.18657,
            41.99636
          ],
          [
            -71.18705,
            41.9963
          ],
          [
            -71.18793,
            41.99666
          ],
          [
            -71.18849,
            41.99726
          ],
          [
            -71.18877,
            41.99745
          ],
          [
            -71.18916,
            41.99777
          ],
          [
            -71.18946,
            41.9981
          ],
          [
            -71.19038,
            41.99916
          ],
          [
            -71.19068,
            41.99941
          ],
          [
            -71.19161,
            42.00036
          ],
          [
            -71.19242,
            42.00121
          ],
          [
            -71.1932,
            42.00208
          ],
          [
            -71.19397,
            42.00291
          ],
          [
            -71.19531,
            42.00438
          ],
          [
            -71.19622,
            42.00536
          ],
          [
            -71.19682,
            42.00586
          ],
          [
            -71.19693,
            42.00615
          ],
          [
            -71.19715,
            42.00642
          ],
          [
            -71.19793,
            42.00725
          ],
          [
            -71.19928,
            42.00869
          ],
          [
            -71.20036,
            42.00988
          ],
          [
            -71.20159,
            42.01118
          ],
          [
            -71.20253,
            42.01222
          ],
          [
            -71.20367,
            42.01345
          ],
          [
            -71.20443,
            42.01425
          ],
          [
            -71.20528,
            42.01518
          ],
          [
            -71.20661,
            42.01664
          ],
          [
            -71.20728,
            42.01729
          ],
          [
            -71.20848,
            42.01862
          ],
          [
            -71.20991,
            42.02015
          ],
          [
            -71.2106,
            42.0209
          ],
          [
            -71.21198,
            42.0224
          ],
          [
            -71.21422,
            42.02481
          ],
          [
            -71.21437,
            42.02497
          ]
        ]
      },
      "properties": {}
    }
  ]
};

    const trailGeojsonLayer = L.geoJSON(trailGeojsonData, {
      style: {
        color: 'blue',
        weight: 4
      }
    }).addTo(map);



    const parkingIcon = L.divIcon({
      className: 'awesome-marker awesome-marker-icon-blue', // pick your color
      html: '<img class="am-glyph" src="../dist/maki/parking.svg" alt="" width="20" height="20" />',
      iconSize: [35, 45],
      iconAnchor: [17, 42],
      popupAnchor: [1, -32]
    });

    const trailheadIcon = L.divIcon({
      className: 'awesome-marker awesome-marker-icon-green', // pick your color
      html: '<img class="am-glyph" src="../dist/maki/park-alt1.svg" alt="" width="20" height="20" />',
      iconSize: [35, 45],
      iconAnchor: [17, 42],
      popupAnchor: [1, -32]
    });

    var airportLots = L.marker([42.006075, -71.196867], { icon: parkingIcon })
            .bindPopup('<h2>Airport Lots</h2>Parking is available on both the north and south sides of Fruit Street');
    var winthropDahlLot = L.marker([41.9961650796283,-71.18548393249513], { icon: parkingIcon })
            .bindPopup('<h2>Winthrop-Dahl Lot</h2>');
    var cobbStreetLot = L.marker([41.992506, -71.184250], { icon: parkingIcon })
            .bindPopup('<h2>Cobb Street Lot</h2>');
    var briggsStreetLot = L.marker([41.962338235815146,-71.15673065185548], { icon: parkingIcon })
            .bindPopup('<h2>Briggs Street Lot</h2>');
    var craneStreetLot = L.marker([41.95195370728311, -71.14685576641179], { icon: parkingIcon });
            // .bindPopup('<h2>Crane Street Lot</h2>');

    fetch('dist/popups/crane-street.html', { cache: 'no-cache' })
            .then(r => r.text())
            .then(html => {
              craneStreetLot.bindPopup(html);
            })
            .catch(err => {
              console.error('Failed to load popup HTML:', err);
              craneStreetLot.bindPopup('<h2>Crane Street Lot</h2><p>Details unavailable.</p>');
            });

    var parkingLots = L.layerGroup([airportLots, winthropDahlLot, cobbStreetLot, briggsStreetLot, craneStreetLot])
            .addTo(map);

    var henrichJohnsonWoods = L.marker([41.987136376558574,-71.18112802505495], { icon: trailheadIcon })
            .bindPopup('<h2>Henrich-Johnson Woods</h2>Owned by LPS, this conservation land includes several trails');

    var conservationLand = L.layerGroup([henrichJohnsonWoods]).addTo(map);


    // Tiles and overlay selection control.
    var tiles = {
      "OSM": osm,
      "CyclOSM": cyclOSM,
    };
    var overlays = {
      "Parking": parkingLots,
      "Trail Systems": conservationLand
    };
    var layerControl = L.control.layers(tiles, overlays).addTo(map);

    // Hide the custom trail route when CyclOSM is selected because it has it brightly marked already.
    map.on('baselayerchange', (e) => {
      if (e.name === "CyclOSM" && map.hasLayer(trailGeojsonLayer)) {
        map.removeLayer(trailGeojsonLayer);
      } else {
        map.addLayer(trailGeojsonLayer);
      }
    });

    map.fitBounds(trailGeojsonLayer.getBounds());
  </script>

</body>
</html>
